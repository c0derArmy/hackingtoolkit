#!/bin/bash

# Advanced Exploitation Tools Module

advanced_exploitation_menu() {
    while true; do
        show_banner
        echo -e "${PURPLE}╔════════════════════════════════════════════════════════════╗${NC}"
        echo -e "${PURPLE}║${BOLD}${WHITE}          ADVANCED EXPLOITATION TOOLS                     ${PURPLE}║${NC}"
        echo -e "${PURPLE}╚════════════════════════════════════════════════════════════╝${NC}"
        echo ""
        echo -e "${CYAN}1)${NC} Cobalt Strike Alternative (Havoc Framework)"
        echo -e "${CYAN}2)${NC} Sliver - C2 Framework"
        echo -e "${CYAN}3)${NC} Mythic - Collaborative C2 Platform"
        echo -e "${CYAN}4)${NC} PoshC2 - PowerShell C2"
        echo -e "${CYAN}5)${NC} Koadic - Windows Post-Exploitation"
        echo -e "${CYAN}6)${NC} Covenant - .NET C2 Framework"
        echo -e "${CYAN}7)${NC} Merlin - Cross-platform Post-Exploitation"
        echo -e "${CYAN}8)${NC} SharpSploit - .NET Post-Exploitation Library"
        echo -e "${CYAN}9)${NC} SILENTTRINITY - Modern C2 Framework"
        echo -e "${CYAN}10)${NC} Impacket - Network Protocol Toolkit"
        echo ""
        echo -e "${YELLOW}0)${NC} Back to Main Menu"
        echo ""
        echo -e "${PURPLE}════════════════════════════════════════════════════════════${NC}"
        echo -ne "${BOLD}${WHITE}Select option: ${NC}"
        read -r choice

        case $choice in
            1) havoc_framework_tool ;;
            2) sliver_tool ;;
            3) mythic_tool ;;
            4) poshc2_tool ;;
            5) koadic_tool ;;
            6) covenant_tool ;;
            7) merlin_tool ;;
            8) sharpsploit_tool ;;
            9) silenttrinity_tool ;;
            10) impacket_tool ;;
            0) return ;;
            *) echo -e "${RED}[X[*] Invalid option${NC}"; pause ;;
        esac
    done
}

havoc_framework_tool() {
    show_banner
    echo -e "${PURPLE}═══ Havoc Framework - Modern C2 Framework ═══${NC}"
    echo ""
    echo -e "${CYAN}1)${NC} Install Havoc Framework"
    echo -e "${CYAN}2)${NC} Run Havoc Server"
    echo -e "${CYAN}3)${NC} Run Havoc Client"
    echo -e "${CYAN}0)${NC} Back"
    echo ""
    echo -ne "${BOLD}${WHITE}Select option: ${NC}"
    read -r choice

    case $choice in
        1)
            echo -e "${YELLOW}[*[*] Installing Havoc Framework...${NC}"
            git clone https://github.com/HavocFramework/Havoc.git
            cd Havoc
            sudo apt-get install -y build-essential cmake python3-dev qtbase5-dev
            make
            cd ..
            echo -e "${GREEN}[+[*] Havoc Framework installed${NC}"
            pause
            ;;
        2)
            echo -e "${YELLOW}[*[*] Starting Havoc Server...${NC}"
            cd Havoc && sudo ./havoc server
            cd ..
            ;;
        3)
            echo -e "${YELLOW}[*[*] Starting Havoc Client...${NC}"
            cd Havoc && ./havoc client
            cd ..
            ;;
        0) return ;;
    esac
}

sliver_tool() {
    show_banner
    echo -e "${PURPLE}═══ Sliver - Adversary Emulation Framework ═══${NC}"
    echo ""
    echo -e "${CYAN}1)${NC} Install Sliver"
    echo -e "${CYAN}2)${NC} Run Sliver Server"
    echo -e "${CYAN}3)${NC} Generate Implant"
    echo -e "${CYAN}0)${NC} Back"
    echo ""
    echo -ne "${BOLD}${WHITE}Select option: ${NC}"
    read -r choice

    case $choice in
        1)
            echo -e "${YELLOW}[*[*] Installing Sliver...${NC}"
            curl https://sliver.sh/install | sudo bash
            echo -e "${GREEN}[+[*] Sliver installed${NC}"
            pause
            ;;
        2)
            echo -e "${YELLOW}[*[*] Starting Sliver Server...${NC}"
            sliver
            ;;
        3)
            echo -e "${YELLOW}[*[*] Run sliver server and use 'generate' command${NC}"
            pause
            ;;
        0) return ;;
    esac
}

mythic_tool() {
    show_banner
    echo -e "${PURPLE}═══ Mythic - Collaborative Multi-Platform C2 ═══${NC}"
    echo ""
    echo -e "${CYAN}1)${NC} Install Mythic"
    echo -e "${CYAN}2)${NC} Start Mythic Server"
    echo -e "${CYAN}3)${NC} Install Agents"
    echo -e "${CYAN}0)${NC} Back"
    echo ""
    echo -ne "${BOLD}${WHITE}Select option: ${NC}"
    read -r choice

    case $choice in
        1)
            echo -e "${YELLOW}[*[*] Installing Mythic...${NC}"
            git clone https://github.com/its-a-feature/Mythic.git
            cd Mythic
            sudo ./install_docker_ubuntu.sh
            sudo make
            cd ..
            echo -e "${GREEN}[+[*] Mythic installed${NC}"
            pause
            ;;
        2)
            echo -e "${YELLOW}[*[*] Starting Mythic...${NC}"
            cd Mythic && sudo ./mythic-cli start
            cd ..
            pause
            ;;
        3)
            echo -e "${YELLOW}[*[*] Installing Mythic Agents...${NC}"
            cd Mythic && sudo ./mythic-cli install github https://github.com/MythicAgents/apfell
            cd ..
            pause
            ;;
        0) return ;;
    esac
}

poshc2_tool() {
    show_banner
    echo -e "${PURPLE}═══ PoshC2 - PowerShell C2 Framework ═══${NC}"
    echo ""
    echo -e "${CYAN}1)${NC} Install PoshC2"
    echo -e "${CYAN}2)${NC} Run PoshC2 Server"
    echo -e "${CYAN}3)${NC} Generate Payload"
    echo -e "${CYAN}0)${NC} Back"
    echo ""
    echo -ne "${BOLD}${WHITE}Select option: ${NC}"
    read -r choice

    case $choice in
        1)
            echo -e "${YELLOW}[*[*] Installing PoshC2...${NC}"
            curl -sSL https://raw.githubusercontent.com/nettitude/PoshC2/master/Install.sh | sudo bash
            echo -e "${GREEN}[+[*] PoshC2 installed${NC}"
            pause
            ;;
        2)
            echo -e "${YELLOW}[*[*] Starting PoshC2...${NC}"
            posh-server
            ;;
        3)
            echo -e "${YELLOW}[*[*] Generating payload...${NC}"
            posh-project -n test
            posh
            pause
            ;;
        0) return ;;
    esac
}

koadic_tool() {
    show_banner
    echo -e "${PURPLE}═══ Koadic - Windows Post-Exploitation ═══${NC}"
    echo ""
    echo -e "${CYAN}1)${NC} Install Koadic"
    echo -e "${CYAN}2)${NC} Run Koadic"
    echo -e "${CYAN}0)${NC} Back"
    echo ""
    echo -ne "${BOLD}${WHITE}Select option: ${NC}"
    read -r choice

    case $choice in
        1)
            echo -e "${YELLOW}[*[*] Installing Koadic...${NC}"
            git clone https://github.com/zerosum0x0/koadic.git
            cd koadic && pip3 install -r requirements.txt
            cd ..
            echo -e "${GREEN}[+[*] Koadic installed${NC}"
            pause
            ;;
        2)
            cd koadic && python3 koadic
            cd ..
            ;;
        0) return ;;
    esac
}

covenant_tool() {
    show_banner
    echo -e "${PURPLE}═══ Covenant - .NET C2 Framework ═══${NC}"
    echo ""
    echo -e "${CYAN}1)${NC} Install Covenant"
    echo -e "${CYAN}2)${NC} Run Covenant"
    echo -e "${CYAN}0)${NC} Back"
    echo ""
    echo -ne "${BOLD}${WHITE}Select option: ${NC}"
    read -r choice

    case $choice in
        1)
            echo -e "${YELLOW}[*[*] Installing Covenant...${NC}"
            sudo apt-get install -y dotnet-sdk-6.0
            git clone --recurse-submodules https://github.com/cobbr/Covenant
            cd Covenant/Covenant && dotnet build
            cd ../..
            echo -e "${GREEN}[+[*] Covenant installed${NC}"
            pause
            ;;
        2)
            cd Covenant/Covenant && dotnet run
            cd ../..
            ;;
        0) return ;;
    esac
}

merlin_tool() {
    show_banner
    echo -e "${PURPLE}═══ Merlin - Cross-platform Post-Exploitation ═══${NC}"
    echo ""
    echo -e "${CYAN}1)${NC} Install Merlin"
    echo -e "${CYAN}2)${NC} Run Merlin Server"
    echo -e "${CYAN}0)${NC} Back"
    echo ""
    echo -ne "${BOLD}${WHITE}Select option: ${NC}"
    read -r choice

    case $choice in
        1)
            echo -e "${YELLOW}[*[*] Installing Merlin...${NC}"
            wget https://github.com/Ne0nd0g/merlin/releases/latest/download/merlinServer-Linux-x64.7z
            7z x merlinServer-Linux-x64.7z -omerlin
            echo -e "${GREEN}[+[*] Merlin installed${NC}"
            pause
            ;;
        2)
            cd merlin && ./merlinServer-Linux-x64
            cd ..
            ;;
        0) return ;;
    esac
}

sharpsploit_tool() {
    show_banner
    echo -e "${PURPLE}═══ SharpSploit - .NET Post-Exploitation Library ═══${NC}"
    echo ""
    echo -e "${CYAN}1)${NC} Clone SharpSploit"
    echo -e "${CYAN}2)${NC} Build SharpSploit"
    echo -e "${CYAN}0)${NC} Back"
    echo ""
    echo -ne "${BOLD}${WHITE}Select option: ${NC}"
    read -r choice

    case $choice in
        1)
            echo -e "${YELLOW}[*[*] Cloning SharpSploit...${NC}"
            git clone https://github.com/cobbr/SharpSploit.git
            echo -e "${GREEN}[+[*] SharpSploit cloned${NC}"
            pause
            ;;
        2)
            echo -e "${YELLOW}[*[*] Building SharpSploit...${NC}"
            cd SharpSploit && dotnet build
            cd ..
            pause
            ;;
        0) return ;;
    esac
}

silenttrinity_tool() {
    show_banner
    echo -e "${PURPLE}═══ SILENTTRINITY - Modern C2 Framework ═══${NC}"
    echo ""
    echo -e "${CYAN}1)${NC} Install SILENTTRINITY"
    echo -e "${CYAN}2)${NC} Run SILENTTRINITY Server"
    echo -e "${CYAN}0)${NC} Back"
    echo ""
    echo -ne "${BOLD}${WHITE}Select option: ${NC}"
    read -r choice

    case $choice in
        1)
            echo -e "${YELLOW}[*[*] Installing SILENTTRINITY...${NC}"
            git clone https://github.com/byt3bl33d3r/SILENTTRINITY.git
            cd SILENTTRINITY && pip3 install -r requirements.txt
            cd ..
            echo -e "${GREEN}[+[*] SILENTTRINITY installed${NC}"
            pause
            ;;
        2)
            cd SILENTTRINITY && python3 st.py
            cd ..
            ;;
        0) return ;;
    esac
}

impacket_tool() {
    show_banner
    echo -e "${PURPLE}═══ Impacket - Network Protocol Toolkit ═══${NC}"
    echo ""
    echo -e "${CYAN}1)${NC} Install Impacket"
    echo -e "${CYAN}2)${NC} Run psexec.py"
    echo -e "${CYAN}3)${NC} Run secretsdump.py"
    echo -e "${CYAN}4)${NC} Run GetNPUsers.py (Kerberoasting)"
    echo -e "${CYAN}5)${NC} Run smbexec.py"
    echo -e "${CYAN}0)${NC} Back"
    echo ""
    echo -ne "${BOLD}${WHITE}Select option: ${NC}"
    read -r choice

    case $choice in
        1)
            echo -e "${YELLOW}[*[*] Installing Impacket...${NC}"
            git clone https://github.com/SecureAuthCorp/impacket.git
            cd impacket && pip3 install .
            cd ..
            echo -e "${GREEN}[+[*] Impacket installed${NC}"
            pause
            ;;
        2)
            echo -ne "${WHITE}Enter domain/username:password@target: ${NC}"
            read -r creds
            cd impacket/examples && python3 psexec.py "$creds"
            cd ../..
            ;;
        3)
            echo -ne "${WHITE}Enter domain/username:password@target: ${NC}"
            read -r creds
            cd impacket/examples && python3 secretsdump.py "$creds"
            cd ../..
            pause
            ;;
        4)
            echo -ne "${WHITE}Enter domain controller IP: ${NC}"
            read -r dc
            cd impacket/examples && python3 GetNPUsers.py -dc-ip "$dc" domain.local/
            cd ../..
            pause
            ;;
        5)
            echo -ne "${WHITE}Enter domain/username:password@target: ${NC}"
            read -r creds
            cd impacket/examples && python3 smbexec.py "$creds"
            cd ../..
            ;;
        0) return ;;
    esac
}
